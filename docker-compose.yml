services:
  trade-executor:
    build:
      context: .
      dockerfile: Dockerfile.trade-executor
    container_name: trade-executor
    env_file:
      - .env
    environment:
      DATABASE_URL: postgresql://aubit:aubit_dev_password@aubit-poly-db:5432/aubit_poly
      RUST_LOG: debug
    command: >
      --dry-run=false
      --verbose-timing
      --assets ALL
      --max-time-to-expiry 5184000
      --max-orderbook-age 30
      --min-profit 0.02
      --max-position-size 10
    restart: unless-stopped
    networks:
      - aubit-net

  orderbook-stream:
    build:
      context: .
      dockerfile: Dockerfile.trade-executor
    container_name: orderbook-stream
    entrypoint: ["orderbook-stream"]
    env_file:
      - .env
    environment:
      DATABASE_URL: postgresql://aubit:aubit_dev_password@aubit-poly-db:5432/aubit_poly
    restart: unless-stopped
    networks:
      - aubit-net

  market-scanner:
    build:
      context: .
      dockerfile: Dockerfile.trade-executor
    container_name: market-scanner
    entrypoint: ["market-scanner"]
    env_file:
      - .env
    environment:
      DATABASE_URL: postgresql://aubit:aubit_dev_password@aubit-poly-db:5432/aubit_poly
    restart: unless-stopped
    networks:
      - aubit-net

  poly-check:
    build:
      context: .
      dockerfile: Dockerfile.trade-executor
    container_name: poly-check
    entrypoint: ["poly-check"]
    env_file:
      - .env
    profiles:
      - tools
    networks:
      - aubit-net

networks:
  aubit-net:
    external: true

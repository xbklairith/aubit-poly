version: '3.8'

services:
  trade-executor:
    build:
      context: .
      dockerfile: Dockerfile.trade-executor
    container_name: trade-executor
    environment:
      DATABASE_URL: ${DATABASE_URL:-postgres://aubit:aubit_dev_password@host.docker.internal:5432/aubit_poly}
    command: >
      --dry-run
      --verbose-timing
      --assets BTC,ETH,SOL,XRP,UNKNOWN
      --max-time-to-expiry 5184000
      --max-orderbook-age 30
      --min-profit 0.02
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"

  orderbook-stream:
    build:
      context: .
      dockerfile: Dockerfile.trade-executor
    container_name: orderbook-stream
    entrypoint: ["orderbook-stream"]
    environment:
      DATABASE_URL: ${DATABASE_URL:-postgres://aubit:aubit_dev_password@host.docker.internal:5432/aubit_poly}
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"

  market-scanner:
    build:
      context: .
      dockerfile: Dockerfile.trade-executor
    container_name: market-scanner
    entrypoint: ["market-scanner"]
    environment:
      DATABASE_URL: ${DATABASE_URL:-postgres://aubit:aubit_dev_password@host.docker.internal:5432/aubit_poly}
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
